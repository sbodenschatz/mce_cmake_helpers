include_guard()

function(is_default_target TARGET OUTPUT_VAR)
	get_property(TGT_TYPE TARGET ${TARGET} PROPERTY TYPE)
	if(${TGT_TYPE} STREQUAL "INTERFACE_LIBRARY")
		set(${OUTPUT_VAR} 0 PARENT_SCOPE)
	else()
		get_property(EXCL_TGT TARGET ${TARGET} PROPERTY EXCLUDE_FROM_ALL)
		if(EXCL_TGT)
			set(${OUTPUT_VAR} 0 PARENT_SCOPE)
		else()
			set(${OUTPUT_VAR} 1 PARENT_SCOPE)
		endif()
	endif()
endfunction()

function(collect_default_targets_direct OUTPUT_LIST)
	set(COLLECTED_TARGETS)
	get_property(CUR_TARGETS DIRECTORY ${DIR} PROPERTY BUILDSYSTEM_TARGETS)
	foreach(TARGET ${CUR_TARGETS})
		is_default_target(${TARGET} DEFAULT_TGT)
		if(DEFAULT_TGT)
			list(APPEND COLLECTED_TARGETS ${TARGET})
		endif()
	endforeach()
	get_property(SUBDIRECTORIES DIRECTORY PROPERTY SUBDIRECTORIES)
	foreach(DIR ${SUBDIRECTORIES})
		get_property(CUR_TARGETS DIRECTORY ${DIR} PROPERTY BUILDSYSTEM_TARGETS)
		foreach(TARGET ${CUR_TARGETS})
			is_default_target(${TARGET} DEFAULT_TGT)
			if(DEFAULT_TGT)
				list(APPEND COLLECTED_TARGETS ${TARGET})
			endif()
		endforeach()
	endforeach()
	set(${OUTPUT_LIST} ${COLLECTED_TARGETS} PARENT_SCOPE)
endfunction()

function(collect_default_targets_recursive OUTPUT_LIST)
	set(COLLECTED_TARGETS)
	get_property(CUR_TARGETS DIRECTORY ${DIR} PROPERTY BUILDSYSTEM_TARGETS)
	foreach(TARGET ${CUR_TARGETS})
		is_default_target(${TARGET} DEFAULT_TGT)
		if(DEFAULT_TGT)
			list(APPEND COLLECTED_TARGETS ${TARGET})
		endif()
	endforeach()
	get_property(SUBDIRECTORIES DIRECTORY ${ARGN} PROPERTY SUBDIRECTORIES)
	foreach(DIR ${SUBDIRECTORIES})
		get_property(EXCL_DIR  DIRECTORY ${DIR} PROPERTY EXCLUDE_FROM_ALL)
		if(NOT EXLC_DIR)
			set(RECURSE_TARGETS)
			collect_default_targets_recursive(RECURSE_TARGETS ${DIR})
			list(APPEND COLLECTED_TARGETS ${RECURSE_TARGETS})
		endif()
	endforeach()
	set(${OUTPUT_LIST} ${COLLECTED_TARGETS} PARENT_SCOPE)
endfunction()

function(collect_all_targets_direct OUTPUT_LIST)
	set(COLLECTED_TARGETS)
	get_property(SUBDIRECTORIES DIRECTORY PROPERTY SUBDIRECTORIES)
	foreach(DIR ${SUBDIRECTORIES})
		get_property(CUR_TARGETS DIRECTORY ${DIR} PROPERTY BUILDSYSTEM_TARGETS)
		list(APPEND COLLECTED_TARGETS ${CUR_TARGETS})
	endforeach()
	set(${OUTPUT_LIST} ${COLLECTED_TARGETS} PARENT_SCOPE)
endfunction()

function(collect_all_targets_recursive OUTPUT_LIST)
	set(COLLECTED_TARGETS)
	get_property(CUR_TARGETS DIRECTORY ${DIR} PROPERTY BUILDSYSTEM_TARGETS)
	list(APPEND COLLECTED_TARGETS ${CUR_TARGETS})
	get_property(SUBDIRECTORIES DIRECTORY ${ARGN} PROPERTY SUBDIRECTORIES)
	foreach(DIR ${SUBDIRECTORIES})
		set(RECURSE_TARGETS)
		collect_all_targets_recursive(RECURSE_TARGETS ${DIR})
		list(APPEND COLLECTED_TARGETS ${RECURSE_TARGETS})
	endforeach()
	set(${OUTPUT_LIST} ${COLLECTED_TARGETS} PARENT_SCOPE)
endfunction()
